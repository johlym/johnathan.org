---
id: 228
title: My Overloaded Server Story
date: 2015-12-07 17:47:35 +0000
author: Johnathan Lyman
layout: post

permalink: "/2015/12/my-overloaded-server-story.html"
categories:
- Blog
---
<div class="kg-card-markdown"><p><em>And the server belongs to me</em></p><p>So as you probably know by now, I converted my blog to <a href="http://jekyllrb.org/">Jekyll</a>, yesterday, and it’s been a huge success, in my opinion. I’m motivated more than ever to start blogging more because I have the added tinker factor and using Git and GitHub to keep everything organized rocks.</p><p>But that isn’t what this story is about. Tonight’s story is about a server. A lowly VPS floating somewhere in the SFO <a href="http://digitalocean.com/">DigitalOcean</a>…. ocean. I’ve had this server running for many months–probably over a year now and I just don’t know it–and it’s hosted just about anything and everything I’ve tinkered with including many a failed idea.</p><p>I use this server a lot and for the most part it always responds well and isn’t sluggish. It’s hosted my former <a href="https://johnathan.org/">WordPress blog</a> since January and hasn’t made but a peep about it so I’ve spent quite a bit of time thinking nothing’s amiss. I felt, though, that Jekyll shouldn’t be taking as long as it was to build my site but I couldn’t convince myself the server was overloaded.</p><p>As it Turns Out<sup>TM</sup>, I was wrong.</p><p>My baby of a server has, for the last five or so months, been filling <a href="http://newrelic.com/">Newrelic</a> graphs with stuff like this:</p><p><strong>CPU</strong></p><p><img src="/assets/images/2015/12/loaded_server_before_cpu.png?resize=525%2C153" alt="loaded_server_before_cpu"></img></p><p></p><p><strong>Memory</strong></p><p><img src="/assets/images/2015/12/loaded_server_before_mem.png?resize=525%2C152" alt="loaded_server_before_mem"></img></p><p></p><p><strong>Disk</strong></p><p><img src="/assets/images/2015/12/loaded_server_before_disk.png?resize=525%2C125" alt="loaded_server_before_disk"></img></p><p></p><p><strong>Load</strong></p><p><img src="/assets/images/2015/12/loaded_server_before_load.png?resize=525%2C189" alt="loaded_server_before_load"></img></p><p></p><p>So I’m just going to go ahead and say that’s not good. The only graph above that’s even remote decent is the Disk graph, but it’s washed over by the CPU &gt; 80% indication so it’s also pretty much hosed.</p><p>At this point I’m honestly surprised. I’m a terrible pseudo-sysadmin and I should be fired but there’s no one to fire me and I’m the boss so whatever. If I can fix all this, I’m giving myself a raise.</p><p>I started digging. I wanted to see what’s running and who’s sucking up all the juices. I fired up <code>top</code> and waited a few seconds. A few things popped up: a couple instances of <code>node</code> and an instance of <code>ruby</code>.</p><p>Hmm. That doesn’t make any sense… I’m not running any node apps and jekyll is the only ruby thing I use right now… oh wait.</p><p>See, I tinkered with NodeJS apps late last spring. <a href="http://ghost.org/">Ghost</a> was a blogging tool I was considering for a while. I also tinkered with <a href="http://discourse.org/">Discourse</a> to see what it was all about. Turns Out<sup>TM</sup>, neither are suited for my needs.</p><p>I don’t really know what happened but I can only assume I forgot about them and they’ve been running all this time. I had a total of five Node instances running and Docker was running Discourse so between the two of them, I was on <code>swap</code> 24/7. So dirty.</p><p>This story isn’t super climactic in any way and the fix was easy: kill all the things. I also found this to be a good time to remove Node and Docker since I need neither.</p><p>I still couldn’t figure out why my disk usage was so high, though. Leave it to me to forget about a 4GB <code>.iso</code> I left in a folder and leave it to Discourse to fail at sending 5GB of emails through postfix over the last five months and clog up my <code>/var/mail</code> folder. Needless to say, after the almost-winter cleaning, I gained quite a bit of ground:</p><p><strong>CPU</strong></p><p><img src="/assets/images/2015/12/loaded_server_after_cpu.png?resize=525%2C151" alt="loaded_server_after_cpu"></img></p><p><strong>Memory</strong></p><p><img src="/assets/images/2015/12/loaded_server_after_mem.png?resize=525%2C151" alt="loaded_server_after_mem"></img></p><p><strong>Disk</strong></p><p><img src="/assets/images/2015/12/loaded_server_after_disk.png?resize=525%2C125" alt="loaded_server_after_disk"></img></p><p><strong>Load</strong></p><p><img src="/assets/images/2015/12/loaded_server_after_load.png?resize=525%2C189" alt="loaded_server_after_load"></img></p><p>Sorry this story wasn’t more interesting. If you’re curious, my Jekyll build time was cut in half.</p><p>That’s about it. Orphaned tools and processes makes my server a dull VPS.</p></div>